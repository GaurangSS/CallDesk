<!-- content -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<div id="content" class="app-content" role="main">
  <div class="app-content-body ">

    <div class="wrapper-md" ng-controller="FormDemoCtrl">

      <div class="panel panel-default">
        <div class="panel-heading font-bold">                  
          Contect Numbers
        </div>
        <div class="panel-body">
          <form class="form-inline" role="form"  method="post">
            <div class="form-group">
              <label for="exampleInputEmail2">Country Name</label>
              <select id='counName' name="counName" class="form-control">
                <option>select country</option>
                <% if (countries.length > 0) {
                
                  for (var i = 0; i < countries.length; i++) { %>
                    <option value=<%= countries[i].counName%> > <%= countries[i].counName%> </option>
                  <% } }%>

              </select>
            </div>
            <div class="form-group">
              <label for="exampleInputPassword2">Area Code</label>
              <select id='areaCode' name=areaCode class="form-control">
                <option>select area</option>
              </select>
            </div>
            
            <span ng-controller="ModalDemoCtrl">
              <script type="text/ng-template" id="myModalContent.html">
                <div ng-include="'tpl/modal.form.html'"></div>
              </script>
              <input class="btn btn-success" id="getNumbers" value="Find Numbers">
            </span>
            <div id='numbers'>
            </div>
          </form>
        </div>
      </div>
    </div>
	</div>
</div> 

<script>
  $(document).ready(function () {

    $('#counName').on('change', function() {
      $('#areaCode').html();
      var counName = $('#counName').val();

      $.ajax({
        type: 'POST',
        url: '/postAreaCode',
        contentType: 'application/json',
        data: JSON.stringify({
          "counName":counName,
        }),
        error: function(e) {
          console.log(e);
        },
        dataType: "json",
        success: function(data) {
          
          var optionsAsString = "<option>select area</option>";
          if (data) {
            for(var i = 0; i < data.length; i++) {
                optionsAsString += "<option value='" + data[i].areaCode + "'>" + data[i].areaCode + "</option>";
            }
          }
            
          $('#areaCode').html( optionsAsString );
        }
      });
    });

    $('#getNumbers').on('click', function() {
      var counName = $('#counName').val();
      var areaCode = $('#areaCode').val();

      $.ajax({
        type: 'POST',
        url: '/contectNumbers',
        contentType: 'application/json',
        data: JSON.stringify({
          "counName": counName,
          "areaCode": areaCode,
        }),
        error: function(e) {
          console.log(e);
        },
        dataType: "json",
        success: function(data) {

          if (data.length > 0) {

            var optionsAsString = "<table class='table table-striped b-t b-light m-b-none' border='1'><tr><th>phone_number</th> <th> Action </th></tr><tbody>";

            for(var i = 0; i < data.length; i++) {
                optionsAsString += "<tr><td> "+data[i].phone_number +"</td><td> <a href='/buyNumber/"+data[i].phone_number+"' class='btn btn-sm btn-primary' >Buy Number</a></td></tr>";
            }

            optionsAsString+= "</tbody></table>";

            $('#numbers').html( optionsAsString );
          }
        }
      });
    });
  });

</script>

  <!-- /content -->
  
  <!-- footer -->

  <!-- / footer -->
